<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    #network-status { margin-left: 1em; font-weight: bold; transition: color 0.3s ease; }
    .status-online { color: green; }
    .status-offline { color: red; }
    .ping-button {
      margin-left: 1em;
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      background: linear-gradient(90deg, #4caf50, #81c784);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .ping-button:hover { background: linear-gradient(90deg, #388e3c, #66bb6a); }
  </style>
</head>
<script>
function openImageModal(src) {
  const modal = document.getElementById('imageModal');
  const img = document.getElementById('modalImage');
  img.src = src;
  modal.classList.add('show');
}
function closeImageModal() {
  document.getElementById('imageModal').classList.remove('show');
}
</script>

<body>
  <header>
    <h1>–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
    <nav>
      <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="{{ url_for('catalog') }}">–ö–∞—Ç–∞–ª–æ–≥</a>
      <a href="{{ url_for('search') }}">–ü–æ–∏—Å–∫</a>
      <a href="{{ url_for('add_car') }}">–î–æ–±–∞–≤–∏—Ç—å</a>
      <button id="theme-toggle">üåô</button>
      <button class="ping-button" onclick="checkNetwork()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å</button>
      <span id="network-status" class="status-online" title="–í—ã –æ–Ω–ª–∞–π–Ω">üåê</span>
    </nav>
  </header>
  <main>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash">
          {% for message in messages %}
            <li class="flash-item">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>
  <footer>
    Flask + SQLite ‚Ä¢ –ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
  </footer>
  <script>
    const html = document.documentElement;
    const toggleBtn = document.getElementById('theme-toggle');
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      html.setAttribute('data-theme', savedTheme);
      toggleBtn.textContent = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }
    toggleBtn.addEventListener('click', () => {
      const current = html.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      toggleBtn.textContent = next === 'light' ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', next);
    });

    function checkNetwork() {
      const status = document.getElementById("network-status");
      status.textContent = "‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...";
      status.className = "";
      fetch("/ping")
        .then(res => res.json())
        .then(data => {
          if (data.status === "online") {
            status.textContent = "üåê –í—ã –æ–Ω–ª–∞–π–Ω";
            status.className = "status-online";
            status.title = "–í—ã –æ–Ω–ª–∞–π–Ω";
          } else {
            status.textContent = "üö´ –í—ã –æ—Ñ—Ñ–ª–∞–π–Ω";
            status.className = "status-offline";
            status.title = "–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";
          }
        })
        .catch(() => {
          status.textContent = "üö´ –û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
          status.className = "status-offline";
          status.title = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ";
        });
    }
    window.addEventListener("load", checkNetwork);
    window.addEventListener("online", checkNetwork);
    window.addEventListener("offline", checkNetwork);
  </script>
</body>
</html>
